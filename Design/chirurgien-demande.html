<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>e-jiraha — Demande d’intervention (Chirurgien)</title>
  <style>
    :root{
      --bg: #F6F7F8;
      --card: #FFFFFF;
      --text: #0F172A;
      --muted: #64748B;
      --line: #E5E7EB;

      --brand: #0F766E;
      --brand-2: #115E59;
      --brand-soft: #E7F6F4;

      --warn: #F59E0B;
      --danger: #EF4444;
      --ok: #10B981;

      --radius-lg: 18px;
      --radius-md: 14px;
      --shadow: 0 10px 30px rgba(2, 6, 23, .08);
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
      color: var(--text);
      background: radial-gradient(1200px 600px at 20% -10%, rgba(15,118,110,.18), transparent 55%),
                  radial-gradient(1200px 600px at 80% -10%, rgba(15,118,110,.10), transparent 55%),
                  var(--bg);
    }

    .phone{
      width: 390px;
      min-height: 820px;
      margin: 24px auto;
      border-radius: 28px;
      background: var(--bg);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid rgba(15, 23, 42, .08);
      position: relative;
    }

    .phone:before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A//www.w3.org/2000/svg'%20width%3D'160'%20height%3D'160'%3E%3Cfilter%20id%3D'n'%3E%3CfeTurbulence%20type%3D'fractalNoise'%20baseFrequency%3D'.9'%20numOctaves%3D'3'%20stitchTiles%3D'stitch'/%3E%3C/filter%3E%3Crect%20width%3D'160'%20height%3D'160'%20filter%3D'url(%23n)'%20opacity%3D'.32'/%3E%3C/svg%3E");
      opacity: .08;
      mix-blend-mode: multiply;
      z-index: 0;
    }

    .topbar{
      position: sticky;
      top: 0;
      z-index: 2;
      background: rgba(246,247,248,.88);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
    }
    .topbar-inner{
      padding: 14px 16px 12px;
      display:flex;
      align-items:center;
      gap: 12px;
      justify-content: space-between;
    }
    .brand{
      display:flex;
      flex-direction: column;
      gap: 2px;
      line-height: 1.1;
    }
    .brand .app{
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 16px;
    }
    .brand .sub{
      font-size: 12px;
      color: var(--muted);
    }
    .top-actions{
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .iconbtn{
      width: 38px;
      height: 38px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #fff;
      display:grid;
      place-items:center;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }
    .icon{
      width: 18px;
      height: 18px;
      display:block;
      color: var(--brand);
    }

    .content{
      padding: 16px;
      display:flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      z-index: 1;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 10px 24px rgba(2,6,23,.06);
    }

    .card.hero{
      background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%);
      border-color: transparent;
      color: #fff;
      box-shadow: 0 12px 26px rgba(15,118,110,.22);
      position: relative;
      overflow: hidden;
    }
    .card.hero:before{
      content:"";
      position:absolute;
      inset:-40px -60px auto auto;
      width: 180px;
      height: 180px;
      background: rgba(255,255,255,.12);
      border-radius: 40px;
      transform: rotate(18deg);
    }
    .card.hero .title{ color: #fff; }
    .card.hero .subtitle{ color: rgba(255,255,255,.88); }

    .title{
      margin: 0;
      font-size: 14px;
      font-weight: 900;
      letter-spacing: .2px;
    }
    .subtitle{
      margin: 6px 0 0;
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      line-height: 1.35;
    }

    .patientbar{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: #F8FAFC;
    }
    .kv{
      display:flex;
      flex-direction: column;
      gap: 4px;
      min-width: 0;
    }
    .kv.right{ text-align: right; align-items: flex-end; }
    .k{
      font-size: 11px;
      font-weight: 900;
      color: rgba(15,23,42,.78);
      letter-spacing: .2px;
    }
    .v{
      font-size: 13px;
      font-weight: 900;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .list{
      display:flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 12px;
    }
    .item{
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      gap: 12px;
      align-items: flex-start;
    }
    .avatar{
      width: 42px;
      height: 42px;
      border-radius: 16px;
      background: rgba(15,118,110,.12);
      border: 1px solid rgba(15,118,110,.18);
      display:grid;
      place-items:center;
      font-weight: 900;
      color: var(--brand);
      flex: 0 0 auto;
    }
    .meta{
      flex: 1 1 auto;
      min-width: 0;
    }
    .meta .row1{
      display:flex;
      gap: 10px;
      align-items: baseline;
      justify-content: space-between;
    }
    .meta .name{
      font-weight: 900;
      font-size: 13px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .meta .time{
      font-size: 11px;
      color: var(--muted);
      flex: 0 0 auto;
    }
    .meta .row2{
      margin-top: 4px;
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
    }
    .choosebtn{
      border: 1px solid rgba(15,118,110,.25);
      background: #fff;
      color: var(--brand-2);
      font-weight: 900;
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 12px;
      cursor: pointer;
      flex: 0 0 auto;
    }

    .field{
      display:flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }
    label{
      font-size: 12px;
      font-weight: 900;
      color: rgba(15,23,42,.86);
      letter-spacing: .2px;
      display:flex;
      align-items:center;
      gap: 4px;
    }
    .required-star{
      color: var(--danger);
      font-size: 12px;
    }
    input[type="text"], textarea, select{
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 14px;
      outline: none;
      background: #fff;
    }
    input[type="text"]:focus, textarea:focus, select:focus{
      border-color: rgba(15,118,110,.55);
      box-shadow: 0 0 0 4px rgba(15,118,110,.14);
    }
    textarea{ min-height: 84px; resize: vertical; }
    .field.error input,
    .field.error textarea,
    .field.error select{
      border-color: rgba(239,68,68,.8);
      box-shadow: 0 0 0 4px rgba(239,68,68,.15);
    }
    .error-msg{
      font-size: 11px;
      color: var(--danger);
      font-weight: 800;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .pill{
      font-size: 11px;
      font-weight: 800;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid var(--line);
      color: #0B1220;
      background: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      width: fit-content;
    }

    .field-header{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 10px;
    }

    .checks{
      display:flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 12px;
    }
    .check{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 10px;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: #fff;
    }
    .check .left{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }
    .check input{ width: 18px; height: 18px; accent-color: var(--brand-2); }
    .check .name{
      font-weight: 900;
      font-size: 13px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chip{
      font-size: 11px;
      font-weight: 900;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: #fff;
      flex: 0 0 auto;
    }
    .chip.todo{ background: #F1F5F9; border-color: #E2E8F0; color: #0F172A; }
    .chip.wait{ background: #FFF7ED; border-color: #FED7AA; color: #9A3412; }
    .chip.ok{ background: #ECFDF5; border-color: #A7F3D0; color: #065F46; }

    .cta{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }
    .btn{
      border: 0;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 900;
      font-size: 13px;
      cursor: pointer;
      flex: 1 1 auto;
      text-align:center;
      text-decoration: none;
      display:block;
    }
    .btn.primary{ background: var(--brand); color: #fff; }
    .btn.ghost{ background: #fff; color: var(--brand); border: 1px solid rgba(15,118,110,.25); }
    .progress-pill{
      font-size: 11px;
      font-weight: 800;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15,118,110,.08);
      color: var(--brand-2);
    }

    .bottom-nav{
      position: sticky;
      bottom: 0;
      background: rgba(246,247,248,.9);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--line);
      padding: 10px 12px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
    }
    .navbtn{
      flex: 1 1 0;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: #fff;
      padding: 10px 8px;
      text-align:center;
      font-size: 11px;
      color: var(--muted);
      font-weight: 800;
      text-decoration: none;
      display:block;
    }
    .navbtn.active{
      background: var(--brand-soft);
      border-color: rgba(15,118,110,.25);
      color: var(--brand-2);
    }
  </style>
</head>

<body>
  <div class="phone">
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <div class="app">e-jiraha</div>
          <div class="sub">Chirurgien • Demande d’intervention</div>
        </div>

        <div class="top-actions">
          <a class="iconbtn" href="chirurgien-dashboard.html" aria-label="Back">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>
      </div>
    </div>

    <div class="content">
      <div class="card hero">
        <h2 class="title">Créer une demande</h2>
        <p class="subtitle">Choisir une admission assignée au chirurgien puis compléter la décision opératoire et les pré-requis.</p>
      </div>

      <div class="card" data-admissions-card>
        <h2 class="title">Admissions assignées</h2>
        <p class="subtitle">Dossiers en attente de décision opératoire / demande.</p>

        <div class="list">
          <div class="item">
            <div class="avatar">RM</div>
            <div class="meta">
              <div class="row1">
                <div class="name">Mr. Rachid M.</div>
                <div class="time">Urgence</div>
              </div>
              <div class="row2">
                <span class="pill">Dossier #CHU-03214</span>
                <span class="chip wait">Bio manquante</span>
              </div>
            </div>
            <button type="button" class="choosebtn" data-name="Mr. Rachid M." data-dossier="#CHU-03214" data-diagnostic="Appendicite aiguë suspectée" data-geste="Appendicectomie">Choisir</button>
          </div>

          <div class="item">
            <div class="avatar">SA</div>
            <div class="meta">
              <div class="row1">
                <div class="name">Mrs. Sara A.</div>
                <div class="time">Consult</div>
              </div>
              <div class="row2">
                <span class="pill">Dossier #CHU-03188</span>
                <span class="chip todo">Décision</span>
                <span class="chip risk">Allergies</span>
              </div>
            </div>
            <button type="button" class="choosebtn" data-name="Mrs. Sara A." data-dossier="#CHU-03188" data-diagnostic="Cholécystite" data-geste="Cholécystectomie">Choisir</button>
          </div>

          <div class="item">
            <div class="avatar">HL</div>
            <div class="meta">
              <div class="row1">
                <div class="name">Mr. Hamza L.</div>
                <div class="time">Transfert</div>
              </div>
              <div class="row2">
                <span class="pill">Dossier #CHU-03102</span>
                <span class="chip ok">Imagerie OK</span>
              </div>
            </div>
            <button type="button" class="choosebtn" data-name="Mr. Hamza L." data-dossier="#CHU-03102" data-diagnostic="Occlusion intestinale" data-geste="Laparotomie exploratrice">Choisir</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="patientbar">
          <div class="kv">
            <div class="k">Patient sélectionné:</div>
            <div class="v" id="selectedName">Mr. Rachid M.</div>
          </div>
          <div class="kv right">
            <div class="k">Dossier</div>
            <div class="v" id="selectedDossier">#CHU-03214</div>
          </div>
        </div>

        <div class="field" data-field="decision">
          <label>Décision opératoire <span class="required-star">*</span></label>
          <select id="decisionSelect">
            <option>À valider</option>
            <option>Opérer</option>
            <option>Reporter</option>
            <option>Annuler</option>
          </select>
          <div class="error-msg" aria-live="polite"></div>
        </div>

        <div class="field" data-field="diagnostic">
          <label>Diagnostic / Motif <span class="required-star">*</span></label>
          <input id="diagnosticInput" type="text" value="Appendicite aiguë suspectée" />
          <div class="error-msg" aria-live="polite"></div>
        </div>

        <div class="field" data-field="geste">
          <label>Geste demandé <span class="required-star">*</span></label>
          <input id="gesteInput" type="text" value="Appendicectomie" />
          <div class="error-msg" aria-live="polite"></div>
        </div>

        <div class="grid2">
          <div class="field" data-field="priorite" style="margin-top: 0;">
            <label>Priorité <span class="required-star">*</span></label>
            <select id="prioritySelect">
              <option>Urgence</option>
              <option>Semi-urgent</option>
              <option>Programmé</option>
            </select>
            <div class="error-msg" aria-live="polite"></div>
          </div>

          <div class="field" data-field="duree" style="margin-top: 0;">
            <label>Durée estimée <span class="required-star">*</span></label>
            <select id="durationSelect">
              <option>45 min</option>
              <option>60 min</option>
              <option>90 min</option>
            </select>
            <div class="error-msg" aria-live="polite"></div>
          </div>
        </div>

        <div class="field">
          <label>Notes</label>
          <textarea id="notesInput">Antécédents: RAS. Allergies: Aucune connue.</textarea>
        </div>

        <div class="field">
          <div class="field-header">
            <label>Pré-requis (à compléter avant anesthésie)</label>
            <span class="progress-pill" id="prProgress">0/0 complétés</span>
          </div>
          <div class="checks">
            <div class="check">
              <div class="left">
                <input type="checkbox" checked />
                <div class="name">Imagerie (Écho/Scanner)</div>
              </div>
              <span class="chip ok">OK</span>
            </div>
            <div class="check">
              <div class="left">
                <input type="checkbox" />
                <div class="name">Biologie (NFS/CRP)</div>
              </div>
              <span class="chip wait">En attente</span>
            </div>
            <div class="check">
              <div class="left">
                <input type="checkbox" />
                <div class="name">Consentement</div>
              </div>
              <span class="chip todo">À faire</span>
            </div>
            <div class="check">
              <div class="left">
                <input type="checkbox" />
                <div class="name">Avis anesthésie</div>
              </div>
              <span class="chip todo">À demander</span>
            </div>
          </div>
        </div>

        <div class="cta">
          <a class="btn ghost" href="chirurgien-dashboard.html">Annuler</a>
          <button class="btn primary" type="button" id="saveBtn">Enregistrer</button>
        </div>
      </div>
    </div>

    <div class="bottom-nav">
      <a class="navbtn" href="chirurgien-dashboard.html">Accueil</a>
      <a class="navbtn" href="chirurgien-patients.html">Patients</a>
      <a class="navbtn" href="chirurgien-profil.html">Profil</a>
    </div>
  </div>

  <script>
    (function(){
      const nameEl = document.getElementById('selectedName');
      const dossierEl = document.getElementById('selectedDossier');
      const diagnosticEl = document.getElementById('diagnosticInput');
      const gesteEl = document.getElementById('gesteInput');
      const notesEl = document.getElementById('notesInput');
      const heroSubtitle = document.querySelector('.hero .subtitle');
      const admissionsCard = document.querySelector('[data-admissions-card]');
      const params = new URLSearchParams(window.location.search);

      const patientParam = params.get('patient');
      const dossierParam = params.get('dossier');
      const diagnosticParam = params.get('diagnostic');
      const gesteParam = params.get('geste');

      if (patientParam) {
        if (nameEl) nameEl.textContent = patientParam;
        if (heroSubtitle) heroSubtitle.textContent = 'Admission pré-sélectionnée depuis le dossier patient.';
      }
      if (dossierParam && dossierEl) {
        dossierEl.textContent = dossierParam;
      }
      if (diagnosticParam && diagnosticEl) {
        diagnosticEl.value = diagnosticParam;
      }
      if (gesteParam && gesteEl) {
        gesteEl.value = gesteParam;
      }
      if (patientParam && admissionsCard) {
        admissionsCard.style.display = 'none';
      }

      document.querySelectorAll('.choosebtn').forEach((btn) => {
        btn.addEventListener('click', () => {
          const name = btn.dataset.name || '';
          const dossier = btn.dataset.dossier || '';
          const diagnostic = btn.dataset.diagnostic || '';
          const geste = btn.dataset.geste || '';

          if (nameEl) nameEl.textContent = name;
          if (dossierEl) dossierEl.textContent = dossier;
          if (diagnosticEl) diagnosticEl.value = diagnostic;
          if (gesteEl) gesteEl.value = geste;
          if (notesEl && notesEl.value.trim().length === 0) notesEl.value = 'Antécédents: RAS.';
        });
      });

      const progressLabel = document.getElementById('prProgress');
      const preReqBoxes = document.querySelectorAll('.check input');
      const updateProgress = () => {
        const total = preReqBoxes.length;
        const completed = Array.from(preReqBoxes).filter((box) => box.checked).length;
        if (progressLabel) progressLabel.textContent = `${completed}/${total} complétés`;
      };
      preReqBoxes.forEach((box) => box.addEventListener('change', updateProgress));
      updateProgress();

      const requiredMap = [
        { id: 'decisionSelect', field: 'decision' },
        { id: 'diagnosticInput', field: 'diagnostic' },
        { id: 'gesteInput', field: 'geste' },
        { id: 'prioritySelect', field: 'priorite' },
        { id: 'durationSelect', field: 'duree' },
      ];

      const validate = () => {
        let ok = true;
        requiredMap.forEach(({ id, field }) => {
          const input = document.getElementById(id);
          const fieldWrap = document.querySelector(`[data-field="${field}"]`);
          if (!input || !fieldWrap) return;
          const value = (input.value || '').trim();
          if (!value) {
            fieldWrap.classList.add('error');
            const msg = fieldWrap.querySelector('.error-msg');
            if (msg) msg.textContent = 'Champ requis';
            ok = false;
          } else {
            fieldWrap.classList.remove('error');
            const msg = fieldWrap.querySelector('.error-msg');
            if (msg) msg.textContent = '';
          }
        });
        return ok;
      };

      requiredMap.forEach(({ id, field }) => {
        const input = document.getElementById(id);
        const fieldWrap = document.querySelector(`[data-field="${field}"]`);
        if (!input || !fieldWrap) return;
        const handler = () => {
          if (fieldWrap.classList.contains('error')) validate();
        };
        input.addEventListener('input', handler);
        input.addEventListener('change', handler);
      });

      const saveBtn = document.getElementById('saveBtn');
      if (saveBtn) {
        saveBtn.addEventListener('click', () => {
          if (validate()) {
            saveBtn.textContent = 'Enregistré ✓';
            saveBtn.style.background = '#0D9488';
            saveBtn.disabled = true;
            setTimeout(() => {
              saveBtn.textContent = 'Enregistrer';
              saveBtn.style.background = '';
              saveBtn.disabled = false;
            }, 2000);
          }
        });
      }
    })();
  </script>
</body>
</html>
